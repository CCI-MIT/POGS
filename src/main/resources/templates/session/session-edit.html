<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/admin-layout.html}">
<!--/*@thymesVar id="_csrf" type="org.springframework.security.web.csrf.CsrfToken"*/-->
 
<head>
    <meta charset="UTF-8">
    <title>POGS - Sessions</title>
</head>
<body>
<div layout:fragment="content" class="container">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/admin">Home</a></li>
        <li class="breadcrumb-item "><a href="/admin/studies">Studies</a></li>
        <li class="breadcrumb-item " th:if="${study.id != null}">
            <a th:href="${'/admin/studies/' + study.id}" th:text="${study.studyName}"></a>
        </li>
        <li class="breadcrumb-item active" th:if="${sessionBean.id != null}">
            <a th:href="${'/admin/studies/' + study.id+ '/sessions/' + sessionBean.id}" th:text="${sessionBean.sessionSuffix}"></a>
        </li>
    </ol>
    <h2>Edit session</h2>
    <form action="#" id="saveSession" th:action="@{/admin/sessions}" th:object="${sessionBean}" method="post">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <input type="hidden" th:field="*{id}"/>
        <input type="hidden" th:field="*{studyId}"/>
        <input type="hidden" th:field="*{roundsEnabled}" th:value="true"/>
        <input type="hidden" th:field="*{numberOfRounds}" th:value="1"/>

        <input type="hidden" th:field="*{status}" th:value="P" />

        <input type="hidden" th:field="*{teamCreationType}" />

        <fieldset class="form-group row">
            <legend class="col-form-legend col-sm-2">Basic</legend>
            <div class="container">
                <fieldset class="form-group row">
                    <legend class="col-form-legend col-sm-2">Session config</legend>
                    <div class="container">
                        <div class="row ">
                            <div class="col">
                                <div class="form-group row">
                                    <label class="col-sm-5 col-form-label" for="sessionScheduleType">Session schedule type:</label>
                                    <div class="col-sm-7">

                                        <select class="custom-select" th:field="*{sessionScheduleType}" id="sessionScheduleType">
                                            <option
                                                    th:each="rg: ${sessionScheduleType}"
                                                    th:value="${rg.id}"
                                                    th:text="${rg.description}" ></option>
                                        </select>

                                    </div>
                                </div>
                            </div>
                            <div class="col">

                                <div class="form-group row">
                                    <label class="col-sm-5 col-form-label" for="sessionSuffix">Suffix:</label>

                                    <div class="input-group col-sm-7">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text" id="sessionSuffix3" th:text="${study.studySessionPrefix}"></span>
                                        </div>
                                        <input type="text" class="form-control" id="sessionSuffix" aria-describedby="sessionSuffix3" th:field="*{sessionSuffix}"/>
                                    </div>
                                    <div class="invalid-feedback" id="sessionSuffixError">Please provide a valid suffix use numbers and letters only</div>
                                </div>
                            </div>
                        </div>
                        <div class="row perpetualSessionType" style="display: none">
                            <div class="col">
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label" for="perpetualStartDate">Perpetual start date:</label>

                                    <div class="col-sm-8">
                                        <div class="form-group">
                                            <div class="input-group date" id="x" data-target-input="nearest">
                                                <input type="text" autocomplete="off" class="form-control" data-target="#perpetualStartDate1" id="perpetualStartDate" th:field="*{perpetualStartDate}"/>
                                                <div class="input-group-append" data-target="#perpetualStartDate1" data-toggle="perpetualStartDate">
                                                    <div class="input-group-text"><i class="fa fa-calendar"><!-- --></i></div>
                                                </div>
                                            </div>
                                            <small id="perpetualStartDate" class="form-text text-muted">All dates and times are based on the U.S. Eastern Time</small>
                                        </div>
                                    </div>
                                    <script type="text/javascript">
                                        $(function () {
                                            jQuery.datetimepicker.setLocale('en');
                                            jQuery('#perpetualStartDate').datetimepicker(
                                                {
                                                    step:5,
                                                    format:'m/d/Y H:i'});
                                        });
                                    </script>


                                </div>
                            </div>
                            <div class="col">
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label" for="perpetualEndDate">Perpetual end date:</label>

                                    <div class="col-sm-8">
                                        <div class="form-group">
                                            <div class="input-group date" id="x" data-target-input="nearest">
                                                <input type="text" autocomplete="off" class="form-control" data-target="#perpetualEndDate1" id="perpetualEndDate" th:field="*{perpetualEndDate}"/>
                                                <div class="input-group-append" data-target="#perpetualEndDate1" data-toggle="perpetualEndDate">
                                                    <div class="input-group-text"><i class="fa fa-calendar"><!-- --></i></div>
                                                </div>
                                            </div>
                                            <small id="perpetualStartDate" class="form-text text-muted">All dates and times are based on the U.S. Eastern Time</small>
                                        </div>
                                    </div>
                                    <script type="text/javascript">
                                        $(function () {
                                            jQuery.datetimepicker.setLocale('en');
                                            jQuery('#perpetualEndDate').datetimepicker(
                                                {
                                                    step:5,
                                                    format:'m/d/Y H:i'});
                                        });
                                    </script>

                                </div>
                            </div>
                        </div>
                        <div class="row perpetualSessionType" style="display: none">
                            <div class="col">
                                <div class="form-group row">
                                    <label class="col-sm-5 col-form-label" for="sessionScheduleType">Condition to start :</label>
                                    <div class="col-sm-7">

                                        <select class="custom-select" th:field="*{scheduleConditionType}" id="sessionScheduleConditionType">
                                            <option
                                                    th:each="rg: ${sessionScheduleConditionType}"
                                                    th:value="${rg.id}"
                                                    th:text="${rg.description}" ></option>
                                        </select>

                                    </div>
                                </div>
                                <div class="row" id="subjectPerpetualPrefix">
                                    <label class="col-sm-4 col-form-label" for="perpetualSubjectsPrefix">Subject prefix:</label>
                                    <div class="col-sm-8">
                                        <input class="form-control" type="text" id="perpetualSubjectsPrefix" th:field="*{perpetualSubjectsPrefix}"/>
                                        <div class="invalid-feedback">Please provide a subject prefix.</div>
                                    </div>
                                </div>
                                <div class="row" id="landingPageUrl" style="display:none">
                                    <label class="col-sm-12 col-form-label" for="perpetualSubjectsPrefix" >
                                    Session landing page url: <b>sessions/<span th:text="${study.studySessionPrefix}"></span><span id="sessionSuffixURL" th:text="*{sessionSuffix}"></span></b>
                                    </label>
                                </div>


                             </div>
                             <div class="col">
                                <div class="row" id="numberOfPerpetualSubjects">
                                    <label class="col-sm-4 col-form-label" for="perpetualSubjectsNumber">Number of subjects to start session:</label>
                                    <div class="col-sm-8">
                                        <input class="form-control " type="number"  min="0" step="1"  id="perpetualSubjectsNumber" th:field="*{perpetualSubjectsNumber}"/>
                                        <div class="invalid-feedback">Please provide a minimal number of subjects to start a session.</div>
                                    </div>
                                </div>
                                <div class="form-group row" id="perpetualScript" style="display: none">
                                    <label class="col-sm-5 col-form-label" for="sessionScheduleType">Condition script to start session:</label>
                                    <div class="col-sm-7">

                                        <select class="custom-select" th:field="*{executableScriptId}" id="sessionScheduleConditionType">
                                            <option
                                                    th:each="rg: ${executableScripts}"
                                                    th:value="${rg.id}"
                                                    th:text="${rg.scriptName}" ></option>
                                        </select>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row scheduledSessionType" style="display: none">
                            <div class="col">
                                <div class="form-group row">
                                    <label class="col-sm-5 col-form-label" for="sessionStartDate">Session Start Date:</label>

                                    <div class="col-sm-7">
                                        <div class="form-group">
                                            <div class="input-group date" id="x" data-target-input="nearest">
                                                <input type="text" autocomplete="off" class="form-control" data-target="#sessionStartDate1" id="sessionStartDate" th:field="*{sessionStartDate}"/>
                                                <div class="input-group-append" data-target="#sessionStartDate1" data-toggle="sessionStartDate">
                                                    <div class="input-group-text"><i class="fa fa-calendar"><!-- --></i></div>
                                                </div>
                                            </div>
                                            <small id="perpetualStartDate" class="form-text text-muted">All dates and times are based on the U.S. Eastern Time</small>
                                        </div>
                                    </div>
                                    <script type="text/javascript">
                                        $(function () {
                                            jQuery.datetimepicker.setLocale('en');
                                            jQuery('#sessionStartDate').datetimepicker(
                                                {
                                                    step:5,
                                                    format:'m/d/Y H:i'});
                                        });
                                    </script>


                                </div>
                            </div>
                            <div class="col">
                                <div class="col-sm-12">
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>

            <div class="container">
                <fieldset class="form-group row">
                    <legend class="col-form-legend col-sm-2">Pages</legend>
                    <div class="container">
                        <fieldset class="form-group row">
                            <legend class="col-form-legend col-sm-2">Intro page</legend>
                            <div class="container" >
                                <div class="form-group row hiddable" >
                                    <label class="col-sm-3 col-form-label" for="introPageEnabled">Intro Page Enabled:</label>
                                    <div class="col-sm-9">
                                        <input class="form-check-input" th:field="*{introPageEnabled}" type="checkbox" id="introPageEnabled" data-trigger="intro" />
                                    </div>
                                </div>

                                <div class="form-group row hideable" data-hide="intro">
                                    <label class="col-sm-3 col-form-label" for="introText">Intro Text:</label>
                                    <div class="col-sm-9">
                                        <textarea class="form-control htmleditor" id="introText" th:field="*{introText}" rows="3"></textarea>
                                    </div>
                                </div>

                                <div class="form-group row hideable" data-hide="intro">
                                    <label class="col-sm-3 col-form-label" for="introTime">Intro Time:</label>
                                    <div class="col-sm-9">
                                        <input class="form-control" type="number" data-number="intro" min="0" step="1" id="introTime" th:field="*{introTime}"/>
                                        <small id="introTimeHelp" class="form-text text-muted">In seconds</small>
                                        <div class="invalid-feedback">Please provide a valid time in seconds greater or equal to 5 seconds.</div>
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label" for="rosterPageEnabled">Roster Page Enabled:</label>
                                    <div class="col-sm-9">
                                        <input class="form-check-input" th:field="*{rosterPageEnabled}" data-trigger="roster"  type="checkbox" id="rosterPageEnabled" />
                                    </div>
                                </div>

                                <div class="form-group row hideable" data-hide="roster">
                                    <label class="col-sm-3 col-form-label" for="rosterTime">Roster Time:</label>
                                    <div class="col-sm-9">
                                        <input class="form-control" data-number="roster" min="0" step="1" type="number" id="rosterTime" th:field="*{rosterTime}"/>
                                        <small id="rosterTimeHelp" class="form-text text-muted">In seconds</small>
                                        <div class="invalid-feedback">Please provide a valid time in seconds greater or equal to 5 seconds.</div>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label" for="waitingRoomTime">Waiting Room - Maximum Waiting Time:</label>
                                    <div class="col-sm-9">
                                        <input class="form-control" type="number"  min="0" step="1" id="waitingRoomTime" th:field="*{waitingRoomTime}"/>
                                        <small id="waitingRoomTimeHelp" class="form-text text-muted">In seconds</small>
                                        <div class="invalid-feedback">Please provide a valid time in seconds greater or equal to 5 seconds.</div>
                                    </div>
                                </div>
                                <!-- input class="form-control" type="hidden"  min="0" step="1" id="waitingRoomTime" th:field="*{waitingRoomTime}"/ -->

                                <div class="form-group row hideable">
                                    <label class="col-sm-3 col-form-label" for="displayNameChangePageEnabled">Display Name Change Page Enabled:</label>
                                    <div class="col-sm-9">
                                        <input class="form-check-input" value="false" data-trigger="displayName"  th:field="*{displayNameChangePageEnabled}" type="checkbox" id="displayNameChangePageEnabled" />
                                    </div>

                                </div>
                                <div class="form-group row hideable" data-hide="displayName">
                                    <label class="col-sm-3 col-form-label" for="displayNameChangeTime">Display Name Change Time:</label>
                                    <div class="col-sm-9">
                                        <input class="form-control" type="number" data-number="displayName" min="0" step="1" id="displayNameChangeTime" th:field="*{displayNameChangeTime}"/>
                                        <small id="displayNameChangeTimeHelp" class="form-text text-muted">In seconds</small>
                                        <div class="invalid-feedback">Please provide a valid time in seconds greater or equal to 5 seconds.</div>
                                    </div>
                                </div>

                                <div class="form-group row hideable">
                                    <label class="col-sm-3 col-form-label" for="displayNameGenerationEnabled">Generate Display Name Enabled:</label>
                                    <div class="col-sm-9">
                                        <input class="form-check-input" value="false"  data-trigger="displayNameGen"  th:field="*{displayNameGenerationEnabled}" type="checkbox" id="displayNameGenerationEnabled" />
                                    </div>
                                    <small id="displayNameGenerator" class="form-text text-muted">If enabled subjects will be assigned random greek letters at the beginning of the session</small>
                                </div>

                                <div class="form-group row hideable"  data-hide="displayNameGen">
                                    <label class="col-sm-3 col-form-label" for="displayNameGeneratorType">Display Name Generator type:</label>
                                    <div class="col-sm-9">
                                        <select class="custom-select" th:field="*{displayNameGenerationType}" id="displayNameGeneratorType">
                                            <option
                                                    th:each="rg: ${nameGenerationType}"
                                                    th:value="${rg.id}"
                                                    th:text="${rg.description}" ></option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                    <div class="container">
                        <fieldset class="form-group row">
                            <legend class="col-form-legend col-sm-2">Done</legend>
                            <div class="container">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label" for="donePageEnabled">Done Page Enabled:</label>
                                    <div class="col-sm-9">
                                        <input class="form-check-input" th:field="*{donePageEnabled}" data-trigger="done"  type="checkbox" id="donePageEnabled" />
                                    </div>
                                </div>
                                <div class="form-group row hideable" data-hide="done">
                                    <label class="col-sm-3 col-form-label" for="donePageText">Done Page Text:</label>
                                    <div class="col-sm-9">
                                        <textarea class="form-control htmleditor" id="donePageText" th:field="*{donePageText}" rows="3"></textarea>
                                    </div>
                                </div>
                                <div class="form-group row hideable" data-hide="done">
                                    <label class="col-sm-3 col-form-label" for="donePageTime">Done Page Time:</label>
                                    <div class="col-sm-9">
                                        <input class="form-control" type="number" data-number="done" min="0" step="1" id="donePageTime" th:field="*{donePageTime}"/>
                                        <small id="donePageTimeHelp" class="form-text text-muted">In seconds</small>
                                        <div class="invalid-feedback">Please provide a valid time in seconds greater or equal to 5 seconds.</div>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label" for="doneRedirectUrl">Done Redirect Url:</label>
                                    <div class="col-sm-9">
                                        <input class="form-control" type="text" id="doneRedirectUrl" th:field="*{doneRedirectUrl}"/>
                                        <div class="invalid-feedback">Please provide a valid URL.</div>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label" for="sessiontosession">Session to session done redirection:</label>
                                    <div class="col-sm-9">
                                        <input class="form-check-input" th:field="*{doneUrlParameter}"  type="checkbox" id="sessiontosession" />
                                    </div>
                                </div>

                            </div>
                        </fieldset>
                    </div>

                </fieldset>
            </div>
        </fieldset>
        <fieldset class="form-group row">
            <legend class="col-form-legend col-sm-8">Advanced - Tasks</legend>
            <div class="container">
                <div class="form-group row">
                    <label class="col-sm-3 col-form-label" for="taskExecutionType">Task Execution Type:</label>
                    <div class="col-sm-9">

                        <select class="custom-select" th:field="*{taskExecutionType}" id="taskExecutionType">
                            <option
                                    th:each="rg: ${taskExecutionTypes}"
                                    th:value="${rg.id}"
                                    th:text="${rg.taskExecutionType}" ></option>
                        </select>

                    </div>
                </div>
                <div class="form-group row" id="fixedInteractionTimeContainer">
                    <label class="col-sm-3 col-form-label" for="fixedInteractionTime">Fixed interaction time:</label>
                    <div class="col-sm-9">
                        <input class="form-control" type="number" data-number="done" min="0" step="1" id="fixedInteractionTime" th:field="*{fixedInteractionTime}"/>
                        <small id="fixedInteractionTimeHelp" class="form-text text-muted">In seconds</small>
                        <div class="invalid-feedback">Please provide a valid time in seconds greater or equal to 5 seconds.</div>
                    </div>
                </div>
            </div>





        </fieldset>
        <fieldset class="form-group row">
            <legend class="col-form-legend col-sm-8">Advanced - Communication</legend>
            <div class="container">
                <div class="form-group row">
                    <label class="col-sm-3 col-form-label" for="chatBotName">Chat Bot Name:</label>
                    <div class="col-sm-9">
                        <input class="form-control" type="text" id="chatBotName" th:field="*{chatBotName}"/>
                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-sm-3 col-form-label" for="communicationType">Communication Type:</label>
                    <div class="col-sm-9">

                        <select class="custom-select" th:field="*{communicationType}" id="communicationType">
                            <option
                                    th:each="rg: ${communicationConstraints}"
                                    th:value="${rg.id}"
                                    th:text="${rg.communicationType}" ></option>
                        </select>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-3 col-form-label" for="videoChatNotificationEmail">Researcher's e-mail:</label>
                    <div class="col-sm-9">
                        <input class="form-control" type="text" id="videoChatNotificationEmail" th:field="*{videoChatNotificationEmail}"/>
                        <small id="videoChatNotificationEmailHelp" class="form-text text-muted">This email will receive a notification with a download link that EXPIRES in 24 hours</small>
                    </div>
                </div>
            </div>
        </fieldset>
        <fieldset class="form-group row">
            <legend class="col-form-legend col-sm-8">Advanced - Feedback</legend>
            <div class="container">
            <div class="form-check form-check-inline">

                        <input class="form-check-input" th:field="*{scoreboardEnabled}" type="checkbox" id="scoreboardEnabled"/>
                        <label class="col-form-label" for="scoreboardEnabled">Scoreboard Enabled</label>

            </div>
             <div class="form-check form-check-inline">

                        <label class="col-form-label" for="scoreboardDisplayType">Scoreboard Display Type:</label>
                        <select class="custom-select" th:field="*{scoreboardDisplayType}" id="scoreboardDisplayType" >
                            <option
                                    th:each="rg: ${scoreboardDisplayTypes}"
                                    th:value="${rg.id}"
                                    th:text="${rg.scoreboardDisplayType}" ></option>
                        </select>

                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" th:field="*{scoreboardUseDisplayNames}" type="checkbox"  id="scoreboardUseDisplayNames" />
                    <label class="col-form-label" for="scoreboardUseDisplayNames">Use Display Names</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" th:field="*{scoreboardAverageSoloSession}" type="checkbox"  id="avgSoloTasks" />
                    <label class="col-form-label" for="avgSoloTasks">Average solo tasks</label>
                </div>
            </div>
        </fieldset>
        <fieldset class="form-group row">
            <legend class="col-form-legend col-sm-8">Advanced - Collaboration tools</legend>
            <div class="container">
                <div class="form-check form-check-inline">

                    <input class="form-check-input" th:field="*{collaborationTodoListEnabled}" type="checkbox" id="collaborationTodoListEnabled" />
                    <label class=" col-form-label" for="collaborationTodoListEnabled">Todo List Enabled</label>

                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" th:field="*{collaborationFeedbackWidgetEnabled}" type="checkbox" id="collaborationFeedbackWidgetEnabled" />
                    <label class=" col-form-label" for="collaborationFeedbackWidgetEnabled">Feedback Widget Enabled</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" th:field="*{collaborationVotingWidgetEnabled}" type="checkbox" id="collaborationVotingWidgetEnabled" />
                    <label class=" col-form-label" for="collaborationVotingWidgetEnabled">Voting Widget Enabled:</label>
                </div>
            </div>
        </fieldset>
        <fieldset class="form-group row">
            <legend class="col-form-legend col-sm-8">Advanced - Team composition</legend>
            <div class="container">
                <div class="form-group row">
                    <label class="col-sm-3 col-form-label" for="teamCreationMethod">Team Creation Method:</label>
                    <div class="col-sm-9">


                        <select class="custom-select" th:field="*{teamCreationMethod}" id="teamCreationMethod">
                            <option
                                    th:each="rg: ${teamCreationMethods}"
                                    th:value="${rg.id}"
                                    th:text="${rg.teamCreationMethod}" ></option>
                        </select>

                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-3 col-form-label" for="teamCreationMoment">Team Creation Moment:</label>
                    <div class="col-sm-9">
                        <select class="custom-select" th:field="*{teamCreationMoment}" id="teamCreationMoment">
                            <option
                                    th:each="rg: ${teamCreationTimes}"
                                    th:value="${rg.id}"
                                    th:text="${rg.teamCreationTime}" ></option>
                        </select>

                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-sm-3 col-form-label" for="teamCreationMatrix">Team Creation Matrix:</label>
                    <div class="col-sm-9">
                        <textarea class="form-control" id="teamCreationMatrix" th:field="*{teamCreationMatrix}" rows="3"></textarea>
                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-sm-3 col-form-label" for="teamMinSize">Team size:</label>
                    <div class="col-sm-9">
                        <input class="form-control" type="number" id="teamMinSize" th:field="*{teamMinSize}"/>
                        <div class="invalid-feedback">Please provide a valid team size greater or equal to 1.</div>
                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-sm-3 col-form-label" for="couldNotAssignToTeamMessage">Could Not Assign To Team Message:</label>
                    <div class="col-sm-9">
                        <input class="form-control" type="text" id="couldNotAssignToTeamMessage" th:field="*{couldNotAssignToTeamMessage}"/>
                        <div class="invalid-feedback">Please provide a message.</div>
                    </div>
                </div>


            </div>

        </fieldset>

        <fieldset class="form-group row">
                    <legend class="col-form-legend col-sm-8">Advanced - Scripts </legend>
                    <div class="container">
                        <div class="form-group row col-sm-12" id="sessionWideScriptId">
                            <label class="col-sm-5 col-form-label" for="sessionWideScriptIdSelect">Session wide script override:</label>
                            <div class="col-sm-7">
                                <select class="custom-select" th:field="*{sessionWideScriptId}" id="sessionWideScriptIdSelect">

                                    <option th:if="*{sessionWideScriptId==null}" selected="selected" value="">No override</option>
                                    <option th:if="*{sessionWideScriptId!=null}"  value="">No override</option>

                                    <option
                                       th:if="${not #lists.isEmpty(sessionWideExecutableScripts) }"
                                            th:each="rg: ${sessionWideExecutableScripts}"
                                            th:value="${rg.id}"
                                            th:text="${rg.scriptName}" ></option>
                                </select>

                            </div>
                        </div>
                    </div>
                    <div class="container">
                        <div class="form-group row col-sm-12" id="beforeSessionScriptId">
                            <label class="col-sm-5 col-form-label" for="beforeSessionScriptIdSelect">Script that runs before the session start:</label>
                            <div class="col-sm-7">
                                <select class="custom-select" th:field="*{beforeSessionScriptId}" id="beforeSessionScriptIdSelect">

                                    <option th:if="*{sessionWideScriptId==null}" selected="selected" value="">No script</option>
                                    <option th:if="*{sessionWideScriptId!=null}"  value="">No script</option>

                                    <option
                                            th:if="${not #lists.isEmpty(sessionBeforeExecutableScripts) }"
                                            th:each="rg: ${sessionBeforeExecutableScripts}"
                                            th:value="${rg.id}"
                                            th:text="${rg.scriptName}" ></option>
                                </select>

                            </div>
                        </div>
                    </div>
                    <div class="container">
                        <div class="form-group row col-sm-12" id="afterSessionScriptId">
                            <label class="col-sm-5 col-form-label" for="afterSessionScriptIdSelect">Script that runs after the session is done:</label>
                            <div class="col-sm-7">
                                <select class="custom-select" th:field="*{afterSessionScriptId}" id="afterSessionScriptIdSelect">

                                    <option th:if="*{sessionWideScriptId==null}" selected="selected" value="">No script</option>
                                    <option th:if="*{sessionWideScriptId!=null}"  value="">No script</option>

                                    <option
                                            th:if="${not #lists.isEmpty(sessionAfterExecutableScripts) }"
                                            th:each="rg: ${sessionAfterExecutableScripts}"
                                            th:value="${rg.id}"
                                            th:text="${rg.scriptName}" ></option>
                                </select>

                            </div>
                        </div>
                    </div>
        </fieldset>



                    <fieldset class="form-group row">
                        <legend class="col-form-legend col-sm-8">Advanced - Robots </legend>
                        <div class="container">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" th:field="*{recordSessionSaveEphemeralEvents}" type="checkbox"  id="recordSessionSaveEphemeralEvents" />
                            <label class="col-form-label" for="recordSessionSaveEphemeralEvents">Record ephemeral events</label>
                            <small id="" class="form-text text-muted">Use only when recording, this can overload the server</small>
                        </div>
                        <div class="form-group row col-sm-12" id="robotSessionEventSourceId">
                                <label class="col-sm-5 col-form-label" for="robotSessionEventSourceIdSelect">Recorded session data source: </label>
                                <div class="col-sm-7">
                                    <select class="custom-select" th:field="*{robotSessionEventSourceId}" id="robotSessionEventSourceIdSelect">

                                        <option th:if="*{robotSessionEventSourceId==null}" selected="selected" value="">No override</option>
                                        <option th:if="*{robotSessionEventSourceId!=null}"  value="">No override</option>

                                        <option
                                           th:if="${not #lists.isEmpty(previousRecordedSessions) }"
                                                th:each="rg: ${previousRecordedSessions}"
                                                th:value="${rg.id}"
                                                th:text="${'# '+rg.id + ' '+rg.sessionSuffix }" ></option>
                                    </select>

                                </div>
                            </div>
                            <div class="form-group row col-sm-12" id="sessionWideScriptId">
                                <label class="col-sm-5 col-form-label" for="sessionWideScriptIdSelect">Session data source override sript:</label>
                                <div class="col-sm-7">
                                    <select class="custom-select" th:field="*{robotSessionEventScriptId}" id="sessionWideScriptIdSelect">

                                        <option th:if="*{robotSessionEventScriptId==null}" selected="selected" value="">No override</option>
                                        <option th:if="*{robotSessionEventScriptId!=null}"  value="">No override</option>

                                        <option
                                           th:if="${not #lists.isEmpty(recordedSessionExecutableScripts) }"
                                                th:each="rg: ${recordedSessionExecutableScripts}"
                                                th:value="${rg.id}"
                                                th:text="${rg.scriptName}" ></option>
                                    </select>

                                </div>
                            </div>
                        </div>
                    </fieldset>

        <!-- Begin research group field -->
        <fieldset class="form-group">
            <legend>Task groups</legend>

            <select multiple="multiple" size="10" th:field="*{sessionHasTaskGroupRelationshipBean.selectedValues}" id="taskGroups">
                <option
                        th:each="rg: ${taskGroups}"
                        th:value="${rg.id}"
                        th:text="${rg.taskGroupName}" ></option>
            </select>
        </fieldset>
        <script>
            function isValidUsernameRegex(value){
                var regexp = /^[a-zA-Z0-9]+$/;
                return (regexp.test(value));
            }
            function validateUrl(value) {
              return /\b((http|https):\/\/?)[^\s()<>]+(?:\([\w\d]+\)|([^[:punct:]\s]|\/?))/i.test(value);
            }
            $(function() {
                function setupScheduleCondition(){
                    var ex = $("#sessionScheduleConditionType").val();
                    if(ex == 'N') {
                        $("#numberOfPerpetualSubjects").show();
                        $("#perpetualScript").hide();
                    } else{
                        $("#perpetualScript").show();
                        $("#numberOfPerpetualSubjects").hide();
                    }
                }

                function setupSchedule(){
                    var ex = $("#sessionScheduleType").val();
                                        if(ex == "P"){
                                            $(".perpetualSessionType").show();
                                            $(".scheduledSessionType").hide();
                                            $("#subjectPerpetualPrefix").show();
                                            $("#landingPageUrl").hide();
                                        }
                                        if(ex == "Q"){
                                            $(".perpetualSessionType").show();
                                            $(".scheduledSessionType").hide();
                                            $("#subjectPerpetualPrefix").hide();
                                            $("#landingPageUrl").show();
                                            setupScheduleCondition();
                                         }
                                        if(ex=="S"){

                                            $(".perpetualSessionType").hide();
                                            $(".scheduledSessionType").show();
                                            setupScheduleCondition();
                                        }
                }

                function checkboxOnClickOnLoad(){
                                    var trigg = $(this).data("trigger");
                                    if($(this).is(':checked')){
                                        console.log("trying to show stuff");
                                        $(".hideable[data-hide='"+trigg+"']").show();
                                    }else{
                                        $(".hideable[data-hide='"+trigg+"']").hide();
                                    }
                                };
                $(":checkbox").click(checkboxOnClickOnLoad);
                $(":checkbox").each(checkboxOnClickOnLoad);

                $(".htmleditor").summernote(
                    {
                    height: 200,
                    toolbar: [
                        // [groupName, [list of button]]
                        ['para', ['style','ul', 'ol', 'paragraph']],
                        ['style', ['bold', 'italic', 'underline', 'clear']],
                        ['font', ['strikethrough', 'superscript', 'subscript']],
                        ['fontsize', ['fontsize']],
                        ['color', ['color']],
                        ['insert', ['picture','link','video','table','codeview']]
                      ],
                      callbacks: {
                          onImageUpload: function(files) {
                        console.log("Send file called success override: " + this);
                        for(var i=0; i < files.length; i++) {
                            sendFile(files[0],this);
                         }
                     }
                    }
                 });

                function sendFile(file,editor) {
                    console.log("Send file method");
                    data = new FormData();
                    data.append("file", file);
                    $.ajax({
                        data: data,
                        type: "POST",
                        url: "/images/upload?[(${_csrf.parameterName})]=[(${_csrf.token})]",
                        cache: false,
                        contentType: false,
                        processData: false,
                        success: function(url) {
                                $(editor).summernote('insertImage', url);
                        }
                    });
                }
                $('#taskGroups')
                    .bootstrapDualListbox({
                                              selectedListLabel:"Chosen groups",
                                              nonSelectedListLabel: "Available groups",
                                              moveAllLabel:"Move all",
                                              removeAllLabel: "Remove all"
                                          });
                /* hack for bootstrap 4 */
                var dualListContainer = $('#researchGroups').bootstrapDualListbox('getContainer');
                dualListContainer.find('.moveall i').removeClass().addClass('fa fa-arrow-right');
                dualListContainer.find('.removeall i').removeClass().addClass('fa fa-arrow-left');
                dualListContainer.find('.move i').removeClass().addClass('fa fa-arrow-right');
                dualListContainer.find('.remove i').removeClass().addClass('fa fa-arrow-left');
                function teamExecSetup(){
                    var ex = $("#taskExecutionType").val();
                    if(ex == "P"){
                        $("#fixedInteractionTimeContainer").show();
                    }else{
                        $("#fixedInteractionTimeContainer").hide();
                    }
                }
                function teamCreationSetup(){
                    var teamMe = $("#teamCreationMethod").val();
                    if(teamMe == "S"){
                        //hide matrix
                        //hide team size
                        $("#teamMinSize").parent().parent().hide();
                        $("#teamCreationMatrix").parent().parent().hide();
                    }
                    if(teamMe == "C"){
                        //hide matrix
                        //show team size
                        $("#teamMinSize").parent().parent().show();
                        $("#teamCreationMatrix").parent().parent().hide();
                    }
                    if(teamMe == "E"){
                        $("#teamMinSize").parent().parent().hide();
                        $("#teamCreationMatrix").parent().parent().show();
                    }


                }
                $("#sessionScheduleType").change(setupSchedule);
                $("#taskExecutionType").change(teamExecSetup);
                $("#teamCreationMethod").change(teamCreationSetup);

                $("#sessionScheduleConditionType").change(setupScheduleCondition);

                $("#sessionSuffix").change(function(){
                    $("#sessionSuffixURL").text($("#sessionSuffix").val())
                })
                teamCreationSetup();
                teamExecSetup();
                setupSchedule();

                $( "#saveSession" ).submit(function( event ) {

                    var valid = true;


                    //time checking not empty or zero
                    $(":checkbox").each(function(){

                        var trig = $(this).data("trigger");
                        if(trig){
                            if($(this).is(':checked')){

                                var numberVar = $(':input[data-number="'+trig+'"]').val();
                                if((numberVar=="" )||(parseInt(numberVar)<5)){
                                   $(':input[data-number="'+trig+'"]').addClass("is-invalid");
                                   valid = false;
                                }
                            }
                        }

                    });
                    if(!validateUrl($("#doneRedirectUrl").val())){
                        $("#doneRedirectUrl").addClass("is-invalid");
                        valid = false;
                    }

                     var teamMe = $("#teamCreationMethod").val();
                        if(teamMe == "S"){
                        }
                        if(teamMe == "C"){
                            //hide matrix
                            //show team size
                            var teamSize = $("#teamMinSize").val();
                            if(teamSize == "" || parseInt(teamSize) <= 0){
                                $("#teamMinSize").addClass("is-invalid");
                                valid = false;
                            }
                        }
                        if(teamMe == "E"){
                            var matrixvalue = $("#teamCreationMatrix").val();
                            if(matrixvalue == ""){
                                $("#teamCreationMatrix").addClass("is-invalid");
                                valid = false;
                            }
                        }
                        if(!isValidUsernameRegex($("#sessionSuffix").val())){
                            $("#sessionSuffixError").show();
                            valid = false;
                        }

                        if($("#couldNotAssignToTeamMessage").val()==""){
                            $("#couldNotAssignToTeamMessage").addClass("is-invalid");
                            valid = false;
                        }

                        var ex = $("#taskExecutionType").val();
                        if(ex == "P"){
                            var time = $("#fixedInteractionTime").val();
                            if(time == "" || parseInt(time) <5 ){
                                $("#fixedInteractionTime").addClass("is-invalid");
                                valid = false;
                            }
                        }
                        var ex2 = $("#sessionScheduleType").val();
                        if(ex2 == "P"){
                            var date = $("#perpetualStartDate").val();
                            $("#sessionStartDate").val(date)
                        }
                        if(ex2 == "Q"){
                            var date = $("#perpetualStartDate").val();
                            $("#sessionStartDate").val(date)
                        }
                        if(ex2 == "S"){
                            var date = $("#sessionStartDate").val();
                            $("#perpetualStartDate").val(date);
                            $("#perpetualEndDate").val(date);
                        }

                    if(!valid){
                        event.preventDefault();
                        event.stopPropagation();
                      }

                });

            });
        </script>
        <!-- End research group field -->





        <!--<div class="form-group row">-->
            <!--<label class="col-sm-2 col-form-label" for="subjectCommunicationId">Subject Communication Id:</label>-->
            <!--<div class="col-sm-10">-->
                <!--<input class="form-control" type="text" id="subjectCommunicationId" th:field="*{subjectCommunicationId}"/>-->
            <!--</div>-->
        <!--</div>-->

        <a class="btn btn-danger btn-primary" th:href="${'/admin/studies/' + study.id + '/sessions/'+ sessionBean.id}">Cancel</a>

        <button th:if="${sessionBean.id == null and not sessionBean.hasSessionStarted}" type="submit" class="btn btn-primary">Create session
        </button>
        <button th:if="${sessionBean.id != null and not sessionBean.hasSessionStarted}" type="submit" class="btn btn-primary">Save session
        </button>
        <br/>
    </form>
</div>
 
</div>
</body>
</html>
